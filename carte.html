<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ma Ville - Carte interactive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
#map { height: 85vh; }
.popup-img { width: 48%; height: auto; border-radius: 8px; margin-top: 5px; }
.popup-container { display: flex; gap: 5px; }
.leaflet-popup-content { max-width: 500px; font-family: Arial, sans-serif; }
</style>
</head>
<body class="bg-gray-50 text-gray-800">
<!-- Navbar -->
<nav class="bg-gray-900 text-white p-4 flex justify-between items-center">
<h1 class="text-xl font-bold">Ma Ville</h1>
<div>
<a href="index.html" class="px-3 hover:text-yellow-400">Accueil</a>
<a href="carte.html" class="px-3 hover:text-yellow-400">Carte interactive</a>
<a href="contact.html" class="px-3 hover:text-yellow-400">Contact</a>
</div>
</nav>


<!-- Barre de recherche -->
<div class="p-4 max-w-xl mx-auto">
<input id="searchInput" type="text" placeholder="Rechercher une ville..." class="w-full p-3 border rounded">
</div>


<div class="flex">
<div id="sidebar" class="w-64 bg-white p-4 border-r border-gray-300">
<button id="toggleFilters" class="bg-gray-200 p-2 rounded w-full mb-2 text-left">Filtres &#9660;</button>
<div id="filtersContent">
  <label class="block"><input type="checkbox" value="musée" checked> Musées</label>
  <label class="block"><input type="checkbox" value="monument" checked> Monuments</label>
  <label class="block"><input type="checkbox" value="parc" checked> Parcs</label>
  <label class="block"><input type="checkbox" value="château" checked> Châteaux</label>
</div>
<div id="map" class="flex-grow"></div>
</div>


<script>
var franceBounds = [[41.0, -5.5], [51.5, 9.5]];
var map = L.map('map', { maxBounds: franceBounds, minZoom: 5, maxZoom: 16 }).fitBounds(franceBounds);


L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
}).addTo(map);


var activities = [
{ name: "Tour Eiffel", coords: [48.8584, 2.2945], description: "Monument emblématique de Paris.", category: "monument", images: ["images/louvre1.jpg", "images/louvre2.jpg"] },
{ name: "Musée du Louvre", coords: [48.8606, 2.3376], description: "Un des plus grands musées du monde.", category: "musée", images: ["images/louvre1.jpg", "images/louvre2.jpg"] },
{ name: "Jardin du Luxembourg", coords: [48.8462, 2.3371], description: "Beau jardin public à Paris.", category: "parc", images: ["images/louvre1.jpg", "images/louvre2.jpg"] },
{ name: "Château de Versailles", coords: [48.8049, 2.1204], description: "Palais royal avec jardins magnifiques.", category: "château", images: ["images/louvre1.jpg", "images/louvre2.jpg"] },
{ name: "Mont Saint-Michel", coords: [48.6360, -1.5115], description: "Îlot rocheux avec abbaye célèbre.", category: "monument", images: ["images/louvre1.jpg", "images/louvre2.jpg"] }
];


var markersByCategory = {};


activities.forEach(function(act) {
var popupContent = `<b>${act.name}</b><br>${act.description}<div class='popup-container'>`;
act.images.forEach(img => { popupContent += `<img src='${img}' class='popup-img'>`; });
popupContent += `</div>`;


var marker = L.marker(act.coords).bindPopup(popupContent, { maxWidth: 500, minWidth: 350 });


if (!markersByCategory[act.category]) { markersByCategory[act.category] = []; }
markersByCategory[act.category].push(marker);
marker.addTo(map);
});


function updateMarkers() {
var checkedCategories = Array.from(document.querySelectorAll('#sidebar input:checked')).map(cb => cb.value);
Object.keys(markersByCategory).forEach(function(cat) {
markersByCategory[cat].forEach(function(marker) {
if (checkedCategories.includes(cat)) { marker.addTo(map); } else { map.removeLayer(marker); }
});
});
}


document.querySelectorAll('#sidebar input').forEach(cb => cb.addEventListener('change', updateMarkers));


document.getElementById('searchInput').addEventListener('keyup', function(e) {
if (e.key === 'Enter') {
var city = this.value;
fetch('https://nominatim.openstreetmap.org/search?format=json&countrycodes=FR&q=' + city)
.then(resp => resp.json())
.then(data => {
if (data.length > 0) {
var lat = data[0].lat, lon = data[0].lon;
map.setView([lat, lon], 12);
L.popup().setLatLng([lat, lon]).setContent(`<b>${city}</b>`).openOn(map);
} else { alert("Ville non trouvée en France !"); }
});
}
});
</script>
</body>
</html>
